<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Mercurity</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" sizes="16x16" href="./images/favicon.ico">

    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <!-- Place favicon.ico in the root directory -->

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">


<style>
    .convertOrder-line{
        height:40px;
        line-height:40px;
        font-size:14px;
    }
    .convertOrder-line .specColor{
        color:#606266;
    }
    .convertOrder-line span{
        display:inline-block;
    }
    .pagination{
        float:left;
    }
    .pageBtn{
        margin-right:10px;
    }
    /* table */
    .table{
        overflow-y: scroll;
        width: 2000px;
    }
    .table thead th{
        vertical-align: top;
    }
      /* loading */
      .loading{
            display: block;
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background:rgba(255, 255, 255, 0.5);
            z-index: 1000;
        }
        .loadingImg{
            width: 170px;
            height: 60px;
            margin-left: 44%;
            margin-top: 250px;
        }
        .tabody{
            display: none;
        }
</style>
</head>

<body>

    <div id="preloader" class="d-none">
        <div class="loader d-none">
            <div class="loader__bar"></div>
            <div class="loader__bar"></div>
            <div class="loader__bar"></div>
            <div class="loader__bar"></div>
            <div class="loader__bar"></div>
            <div class="loader__ball"></div>
        </div>
    </div>


    <!-- header -->
    <div class="header">
            <div class="nav-header">
                <div class="brand-logo">
                    <a href="index.html">
                        <!-- <i class="icofont icofont-dart"></i> -->   
                        <span class="brand-title">Mercurity</span>
                    </a>
                </div>
            </div>
    
            <div class="header-content">
                <div class="header-left d-flex">
                    <div class="nav-control">
                        <div class="hamburger">
                            <span class="line"></span>
                            <span class="line"></span>
                            <span class="line"></span>
                        </div>   
                    </div>    
                </div>
            </div>
            <div class="navbar-custom-menu pull-right d-flex nav-right">   
                <div class="dropdown">
                    <a class="dropdown-toggle user-profile-dropdown" href="#" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="user-img">
                        </span>
                        <span class="user-name" id="emailName"></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                        <a class="dropdown-item" href="#" id="logoutBtn">
                            <i class="fa fa-power-off" aria-hidden="true"></i> Logout
                        </a>
                    </div>
                </div>
    
            </div>
    </div>
    <!-- #/ header -->


    <!-- sidebar -->
    <div class="nk-sidebar">
            <div class="nk-nav-scroll">
                <ul class="metismenu" id="menu">
                    <li style="padding-top: 22px;">
                        <a href="index.html" aria-expanded="true">
                            <i class="fa fa-dashboard"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:;" aria-expanded="false" id="akyc">
                            <i class="fa fa-user"></i>
                            <span class="nav-text">KYC/AML</span>
                        </a>
                    </li>
                    <li>
                            <a class="has-arrow" href="#" aria-expanded="false">
                                <i class="fa fa-folder-open"></i>
                                <span class="nav-text">My Transaction</span>
                            </a>
                            <ul aria-expanded="false">
                                    <li>
                                        <a href="convertOrder.html">Purchase Order</a>
                                    </li>
                                    <li>
                                        <a href="redeemOrder.html">Redeem Order</a>
                                    </li>
                            </ul>
                    </li>
                </ul>
            </div>
            <!-- #/ nk nav scroll -->
    </div>
    <!-- #/ sidebar -->


<!-- contents start -->
    <div class="content-body" id="container">
        <!-- loading page -->
        <div class="loading" id="fakeLoader">
            <img src="images/loading.gif" alt="" class="loadingImg">
        </div>
        <!--  loading page end-->
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <h2 class="page-title">Purchase Order List</h2>
                </div>
            </div>
        </div>

        <div class="marketcap-section">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
            
                            <div class="accordion table-data">
                                    <div class="card rounded-0">
                                        <div id="table-two" class="collapse show table-responsive">
                                            <table class="table m-b-0">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">Order ID</th>
                                                        <th scope="col">Order Status</th>
                                                        <th scope="col">ERC20 Address</th>
                                                        <th scope="col">Token Name</th>
                                                        <th scope="col">Token Amount</th>
                                                        <th scope="col">Transaction Fee</th>
                                                        <th scope="col">Total Payment Due</th>
                                                        <th scope="col">Memo Code</th>
                                                        <th scope="col">Order Time </th>
                                                    </tr>
                                                </thead>
                                                <!-- <tbody class="tabody" v-show="totalCount!==0"> -->
                                                <tbody>
                                                    <tr v-for="(item, index) in listData" :key="index">
                                                        <td>{{item.order_id}}</td>
                                                        <td>{{item.order_status}}</td>
                                                        <td>{{item.wallet_address}}</td>
                                                        <td>{{item.token_name}}</td>
                                                        <td>{{item.tokenAmount}}</td>
                                                        <td>${{item.purchase_fee}}</td>
                                                        <td>${{item.order_amount}}</td>
                                                        <td>{{item.mem_code}}</td>
                                                        <td>{{item.creatTime}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                            </div>
                     

                    </div>
                </div>
                <!-- pagination start -->
                <div class="row">
                    <!-- <div class="col-lg-6">
                        <p class="m-b-0">Showing 1 to 10 of 1330</p>
                    </div> -->
                    <div class="col-lg-12">
                        <nav aria-label="Page m-b-0">
                            <ul class="pagination pagination-flat" v-for="item in pageCount+1">
                                <!-- {{item}} -->
                                <li class="page-item" v-if="item==1" v-on:click="showPage(pageCurrent-1,$event)">
                                    <a class="page-link" href="#">Previous</a>
                                </li>
                                <li v-if="item==1" class="pageBtn" v-on:click="showPage(item,$event)">
                                    <a class="page-link active" href="#">{{item}}</a>
                                </li>
                                <!-- <li v-if="item==1&&item<showPagesStart-1" class="pageBtn disabled">
                                    ...
                                </li> -->
                                <li v-if="item>1&&item<=pageCount-1&&item>=showPagesStart&&item<=showPageEnd&&item<=pageCount" class="pageBtn" v-on:click="showPage(item,$event)">
                                    <a class="page-link" href="#">{{item}}</a>
                                </li>
                                <li v-if="item==pageCount&&item>showPageEnd+1" class="pageBtn disabled">
                                    ...
                                </li>
                                <li v-if="item==pageCount&& item!=1" class="pageBtn" v-on:click="showPage(item,$event)">
                                    <a class="page-link" href="#">{{item}}</a>
                                </li>
                                <li v-if="item==pageCount" class="page-item" v-on:click="showPage(pageCurrent+1,$event)">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <!-- pagination end -->
            </div>
        </div>

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <p class="copyright">&copy; Copyright 2018 by Mercurity. All Rights Reserved.</p>
                </div>
            </div>
        </div>
    </div>





    <!-- Modernizr-3 -->
    <!-- jQuery -->
    <script src="../assets/plugins/common/common.min.js"></script>


    <!-- custom scripts -->
    <script src="js/scripts.js"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/axios.min.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/login.js"></script>
<script>
      var vue = new Vue({
                  el:'#container',
                  data: function data() {
                    return {
                        data: {
                            page_num: 1, // 必填,页码数
                            page_size: 10 // 必填,每页显示多少条数据
                        },
                        page: 0,
                        listData: [],
                        classList:['collapseOne','collapseTwo','collapseThree','collapseFour','collapseFive','collapseSix','collapseSeven','collapseEight','collapseNine','collapseTen'],
                        // pagesize: 10
                        //总项目数
                        totalCount: 0,
                        //分页数
                        pageCount: 1,
                        //当前页面
                        pageCurrent: 1,
                        //分页大小
                        pagesize: 10,
                        //显示分页按钮数
                        showPages:5 ,
                        //开始显示的分页按钮
                        showPagesStart: 1,
                        //结束显示的分页按钮
                        showPageEnd: 100
                    };
                  },
            // created: function () {
            //     // `this` 指向 vm 实例
            //           $('#fakeLoader').show()
            // },
            components: {},
            methods: {
                getConvertOrder () {
                    axios({
                        method: 'post',
                        url: 'http://39.106.60.55:8081/user/getOrderListByUserId',
                        headers:{
                            token:localStorage.getItem('loginToken')
                        },
                        params: {
                            // pageNum: this.data.page_num, 
                            // numPerPage: this.data.page_size
                            pageNum: this.pageCurrent,
                            numPerPage: this.pagesize
                        }
                    }).then(response => {
                        var data = response.data
                        if (data.code === '200') {
                            $('#fakeLoader').hide()
                            
                            this.page = data.data.totalCount
                            this.totalCount = data.data.totalCount
                            this.listData = data.listData
                          
                            // this.showPage(this.pageCurrent, null, true)
                        } else if (data.code === '500') {
                            $('#fakeLoader').hide()
                            alert(data.message)
                            if(data.data.status==='499'){
                                localStorage.clear()
                                $(location).attr('href', 'login.html')
                            }
                        }else if(data.code==='499'){
                            localStorage.clear()
                            $(location).attr('href', 'login.html')
                        }
                    }).catch(errortip => {})
                           
                },
            showPage (pageIndex, $event, forceRefresh) {
 
                if (pageIndex > 0) {

                    if (pageIndex > this.pageCount) {
                        pageIndex = this.pageCount;
                    }
                    //判断数据是否需要更新
                    var currentPageCount = Math.ceil(this.totalCount / this.pagesize);
                    if (currentPageCount != this.pageCount) {
                        pageIndex = 1;
                        this.pageCount = currentPageCount;
                    }else if (this.pageCurrent == pageIndex && currentPageCount == this.pageCount && typeof (forceRefresh) == "undefined") {
                        console.log("not refresh");
                        return;
                    }
                    //处理分页点中样式
                    var buttons = $(".pagination").find("a");
                    for (var i = 0; i < buttons.length; i++) {
                        if (buttons.eq(i).html() != pageIndex) {
                            buttons.eq(i).removeClass("active");
                        }
                        else {
                            buttons.eq(i).addClass("active");
                        }
                    }
                    this.pageCurrent = pageIndex;
                    //计算分页按钮数据
                    if (this.pageCount > this.showPages) {
                        if (pageIndex <= (this.showPages - 1) / 2) {
                            this.showPagesStart = 1;
                            this.showPageEnd = this.showPages - 1;
                            console.log("showPage1")
                        }else if (pageIndex >= this.pageCount - (this.showPages - 3) / 2) {
                            this.showPagesStart = this.pageCount - this.showPages + 2;
                            this.showPageEnd = this.pageCount;
                            console.log("showPage2")
                        }else {
                            console.log("showPage3")
                            this.showPagesStart = pageIndex - (this.showPages - 3) / 2;
                            this.showPageEnd = pageIndex + (this.showPages - 3) / 2;
                        }
                    }
                    // console.log("showPagesStart:" + this.showPagesStart + ",showPageEnd:" + this.showPageEnd + ",pageIndex:" + pageIndex);
                    this.getConvertOrder()
                }
                    
            },
                
                  
        },
            mounted: function mounted() {
                   this.getConvertOrder()
                   let _this = this
                   setTimeout(function() {
                       _this.showPage(_this.pageCurrent, null, true)
                   },2000)
                   
                }
        });
      // jq header Email
      function getEmail(){
            var email = localStorage.getItem('email');
            $("#emailName").html(email);
        }
        window.onload = function() {
            getEmail()
            getHome()
        }
</script>

</body>

</html>
